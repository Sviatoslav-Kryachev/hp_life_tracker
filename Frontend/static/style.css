* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Prevent horizontal scroll globally on mobile */
html {
    overflow-x: hidden;
    width: 100%;
    max-width: 100vw;
}

body {
    overflow-x: hidden;
    width: 100%;
    max-width: 100vw;
}

body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

/* Базовый .container вынесен в components/layout/grid.css */

/* Убеждаемся, что все контейнеры с max-w-6xl ограничены */
.max-w-6xl {
    max-width: 1152px !important; /* max-w-6xl = 72rem = 1152px */
    margin-left: auto !important;
    margin-right: auto !important;
    width: 100% !important;
    box-sizing: border-box !important;
}

/* Карточки и анимации вынесены в модули components/common/ */




#rewards-list-container,
#history-list-container {
    position: relative;
}

/* Когда аккордеон наград открыт - контейнер становится скроллируемым */
#rewards-list-container.rewards-expanded {
    overflow-y: auto !important;
    overflow-x: hidden !important;
    transition: max-height 300ms ease;
}

/* При открытом аккордеоне наград скрываем visible и показываем hidden */
#rewards-list-container.rewards-expanded #rewards-list-visible {
    display: none !important;
}

#rewards-list-container.rewards-expanded #rewards-list-hidden {
    display: block !important;
    max-height: none !important;
    overflow: visible !important;
    position: relative !important;
}

/* Убираем fixed позиционирование при открытом аккордеоне наград */
#rewards-list-container.rewards-expanded .reward-card {
    position: relative !important;
    top: auto !important;
    z-index: auto !important;
}

/* Когда аккордеон истории открыт - контейнер становится скроллируемым */
/* Этот стиль применяется когда класс history-expanded на контейнере */
#history-list-container.history-expanded {
    overflow-y: auto !important;
    overflow-x: hidden !important;
    flex: 1 1 0;
    min-height: 0;
    /* Контейнер заполняет доступное пространство через flex, не расширяется вниз */
}

/* При открытом аккордеоне истории скрываем visible и показываем hidden */
#history-list-container.history-expanded #history-list-visible {
    display: none !important;
    position: relative !important;
    top: auto !important;
    background: transparent !important;
    padding-bottom: 0 !important;
    margin-bottom: 0 !important;
    z-index: 1 !important;
}

#history-list-container.history-expanded #history-list-visible::after {
    display: none !important;
}

#history-list-container.history-expanded #history-list-hidden {
    display: block !important;
    max-height: none !important;
    overflow: visible !important;
    position: relative !important;
}

/* Убираем sticky позиционирование при открытом аккордеоне истории */
#history-list-container.history-expanded .history-fixed {
    position: relative !important;
    top: auto !important;
    z-index: auto !important;
    background: transparent !important;
    padding-bottom: 0 !important;
    margin-bottom: 0 !important;
}

#rewards-list-hidden,
#history-list-hidden {
    overflow: visible;
}

/* Умный аккордеон для активностей с ограниченной высотой и скроллом */
#activities-list-container {
    position: relative;
}

#activities-list-hidden {
    overflow-x: hidden;
    max-height: 0;
    overflow-y: hidden;
}

/* Когда аккордеон открыт - весь контейнер становится скроллируемым */
#activities-list-container.activities-expanded {
    overflow-y: auto !important;
    overflow-x: hidden !important;
}

#activities-list-container.activities-expanded #activities-list-visible {
    display: none !important;
}

#activities-list-container.activities-expanded #activities-list-hidden {
    display: block !important;
    max-height: none !important;
    overflow: visible !important;
    position: relative !important;
}

#activities-list-container.activities-expanded .activity-card {
    position: relative !important;
    top: auto !important;
    z-index: auto !important;
}

/* ============= RESPONSIVE STYLES ============= */

/* Мобильная навигация - показ/скрытие секций вместо скролла */
@media (max-width: 1024px) {
    /* По умолчанию все grid контейнеры скрыты на мобильных */
    .grid.lg\\:grid-cols-3 {
        display: none !important;
    }
    
    /* Показываем только те, которые имеют класс mobile-section-visible */
    .mobile-section-visible {
        display: grid !important; /* grid для grid контейнеров */
    }
    
    .mobile-section-hidden {
        display: none !important;
    }
    
    /* Блоки Today, Calendar, Progress всегда видны */
    .grid.grid-cols-1.md\\:grid-cols-3 {
        display: grid !important;
    }
    
    /* Grid контейнеры для секций - переопределяем скрытие если есть класс visible */
    .grid.lg\\:grid-cols-3.mobile-section-visible {
        display: grid !important;
    }
    
    .grid.lg\\:grid-cols-3.mobile-section-hidden {
        display: none !important;
    }
    
    /* Sidebar (цели) - скрыт по умолчанию */
    .grid.lg\\:grid-cols-3 > .lg\\:col-span-1 {
        display: none !important;
    }
    
    .grid.lg\\:grid-cols-3 > .lg\\:col-span-1.mobile-section-hidden {
        display: none !important;
    }
    
    .grid.lg\\:grid-cols-3 > .lg\\:col-span-1.mobile-section-visible {
        display: block !important;
    }
}

/* Mobile devices (до 640px) */
@media (max-width: 640px) {
    html, body {
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100vw !important;
        position: relative !important;
    }
    
    body {
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100vw !important;
    }
    
    /* Стили хедера вынесены в components/header/header.css */
    
    /* Отступ для контейнера приложения - учитываем safe area на iOS */
    @supports (padding: env(safe-area-inset-top)) {
        #app-section > .container {
            padding-top: calc(4.5rem + env(safe-area-inset-top));
        }
    }
    
    /* Специфичные стили для .container в мобильной версии (базовые в components/layout/) */
    .container {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
        margin-left: auto;
        margin-right: auto;
        width: 100%;
        max-width: 100%;
    }
    
    /* Центрируем все блоки */
    #app-section .container > div {
        width: 100%;
        margin-left: auto;
        margin-right: auto;
    }
    
    /* Убеждаемся, что все grid контейнеры имеют одинаковую ширину */
    .grid.grid-cols-1,
    .grid.grid-cols-1.md\\:grid-cols-3 {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        gap: 1rem !important;
    }
    
    /* Все блоки внутри grid должны иметь одинаковую ширину */
    .grid.grid-cols-1 > div,
    .grid.grid-cols-1.md\\:grid-cols-3 > div {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
    }
    
    /* Убираем обрезание контента */
    #app-section .container {
        overflow-x: visible;
        overflow-y: visible;
    }
    
    /* Исправляем боковую панель (sidebar) - убираем обрезание */
    .grid.lg\\:grid-cols-3 > .lg\\:col-span-1 {
        padding-left: 0 !important;
        padding-right: 0 !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
        overflow: visible !important;
    }
    
    /* Исправляем блоки внутри sidebar */
    .grid.lg\\:grid-cols-3 > .lg\\:col-span-1 > div {
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding-left: 0.75rem !important;
        padding-right: 0.75rem !important;
        width: 100% !important;
        max-width: 100% !important;
        overflow: visible !important;
        box-sizing: border-box !important;
    }
    
    /* Исправляем обрезание карточек */
    .bg-gradient-to-br,
    .bg-white,
    .bg-white\/80,
    .bg-white\/90 {
        overflow: visible !important;
        word-wrap: break-word;
        box-sizing: border-box !important;
    }
    
    /* Фиксируем grid контейнер на мобильных */
    .grid.lg\\:grid-cols-3 {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        gap: 1rem !important; /* Уменьшаем gap на мобильных */
    }
    
    /* Фиксируем блок активности внутри grid на мобильных */
    .grid.lg\\:grid-cols-3 > #activities,
    .grid.lg\\:grid-cols-3 > .lg\\:col-span-2 {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding-left: 0.75rem !important;
        padding-right: 0.75rem !important;
    }
    
    /* Исправляем обрезание блоков справа на мобильных (Xiaomi/Android) */
    #activities,
    #activities > div,
    .bg-gradient-to-r.from-blue-50.to-indigo-50 {
        padding-right: 0.75rem !important;
        padding-left: 0.75rem !important;
        margin-right: 0 !important;
        margin-left: 0 !important;
        box-sizing: border-box !important;
        max-width: 100% !important;
        width: 100% !important;
        overflow-x: hidden !important;
        overflow-y: visible !important;
    }
    
    /* Все элементы внутри блока активности должны учитывать ширину */
    #activities * {
        max-width: 100% !important;
        box-sizing: border-box !important;
    }
    
    /* Фиксируем карточки активности на мобильных */
    .activity-card {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        padding-left: 0.75rem !important;
        padding-right: 0.75rem !important;
        overflow-x: hidden !important;
    }
    
    /* Убеждаемся, что flex элементы в карточке активности могут уменьшаться */
    .activity-card > div:first-child {
        min-width: 0 !important;
        flex: 1 1 auto !important;
        max-width: 100% !important;
        overflow: hidden !important;
    }
    
    /* Кнопки справа в карточке активности */
    .activity-card > button,
    .activity-card .timer-btn,
    .activity-card .manual-time-btn,
    .activity-card .edit-btn,
    .activity-card .delete-btn {
        flex-shrink: 0 !important;
        min-width: auto !important;
    }
    
    /* Уменьшаем gap между элементами в карточке активности на мобильных */
    .activity-card {
        gap: 0.5rem !important;
    }
}

/* Tablets (640px - 1024px) */
@media (min-width: 640px) and (max-width: 1024px) {
    /* Нормальные стили для планшетов - без минимизации */
}

/* Prevent horizontal scroll on all devices */
@media (max-width: 1024px) {
    html {
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100vw !important;
        position: relative !important;
    }
    
    body {
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100vw !important;
        position: relative !important;
    }
    
    * {
        max-width: 100% !important;
        box-sizing: border-box !important;
    }
    
    /* Фиксируем все контейнеры - но не обрезаем контент */
    .container,
    #app-section,
    #app-section > div {
        max-width: 100% !important;
        width: 100% !important;
        box-sizing: border-box !important;
    }
    
    /* Убеждаемся, что контейнеры не выходят за границы */
    .container {
        max-width: 100%;
        padding-left: 0.75rem;
        padding-right: 0.75rem;
        margin-left: auto;
        margin-right: auto;
        box-sizing: border-box !important;
    }
    
    /* Стили хедера вынесены в components/header/header.css */
    
    /* Фиксируем ширину для grid элементов */
    .grid {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
    }
    
    /* Убеждаемся, что grid контейнер не создает горизонтальный скролл */
    .grid.lg\\:grid-cols-3 {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        gap: 1rem !important; /* Уменьшаем gap на мобильных */
    }
    
    /* Фиксируем блок активности внутри grid */
    .grid.lg\\:grid-cols-3 > #activities,
    .grid.lg\\:grid-cols-3 > .lg\\:col-span-2 {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding-left: 0.75rem !important;
        padding-right: 0.75rem !important;
    }
    
    /* Все элементы внутри блока активности должны учитывать ширину */
    #activities * {
        max-width: 100% !important;
        box-sizing: border-box !important;
    }
    
    /* Фиксируем карточки активности на всех мобильных устройствах */
    .activity-card {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        overflow-x: hidden !important;
    }
    
    /* Убеждаемся, что flex элементы в карточке активности могут уменьшаться */
    .activity-card > div:first-child {
        min-width: 0 !important;
        flex: 1 1 auto !important;
        max-width: calc(100% - 12rem) !important; /* Оставляем место для кнопок */
        overflow: hidden !important;
    }
    
    /* Кнопки справа в карточке активности */
    .activity-card > button,
    .activity-card .timer-btn,
    .activity-card .manual-time-btn,
    .activity-card .edit-btn,
    .activity-card .delete-btn {
        flex-shrink: 0 !important;
        min-width: auto !important;
        width: auto !important;
    }
    
    /* Исправляем обрезание блоков справа на Android/Xiaomi */
    #activities,
    #activities > div,
    .bg-gradient-to-r.from-blue-50.to-indigo-50 {
        padding-right: 1rem !important;
        margin-right: 0 !important;
        box-sizing: border-box !important;
        max-width: 100% !important;
        width: 100% !important;
        overflow-x: visible !important;
        overflow-y: visible !important;
    }
}

/* Показываем нижнее меню на мобильных устройствах (до 1024px) */
@media (max-width: 1024px) {
    #bottom-navigation {
        display: flex !important;
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 1000 !important;
        background: white !important;
    }
}

/* Скрываем на десктопах */
@media (min-width: 1025px) {
    #bottom-navigation {
        display: none !important;
    }
}

/* Стили хедера вынесены в components/header/header.css */

/* Улучшаем отображение на очень маленьких экранах (< 400px) */
@media (max-width: 400px) {
    /* Скрываем некоторые элементы на очень маленьких экранах */
    .hidden.sm\:block {
        display: none !important;
    }
}

/* Убираем дублирующиеся стрелки в выпадающих списках */
#activities-sort,
#activities-category-filter {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
}

/* ============= SOCIAL SECTIONS (Groups, Leaderboard, Challenges, Achievements) ============= */

/* Контейнер социальных секций - ограничиваем шириной родительского контейнера */
#social {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
}

/* Все блоки социальных секций - обновлено для новой структуры с колонками */
#social > div {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
    min-width: 0 !important;
}

/* Контейнеры компонентов внутри колонок */
#social #section-groups-container,
#social #section-challenges-container,
#social #section-leaderboard-container,
#social #section-achievements-container {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
}

/* Внутренние контейнеры списков */
#groups-list,
#leaderboard-list,
#challenges-list,
#achievements-list {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    word-wrap: break-word !important;
    padding-right: 0.5rem !important;
}

/* Скроллбары вынесены в components/common/scrollbars.css */

/* Карточки внутри списков */
#groups-list > div,
#leaderboard-list > div,
#challenges-list > div,
#achievements-list > div {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    min-width: 0 !important;
}

/* Все элементы внутри карточек */
#groups-list > div *,
#leaderboard-list > div *,
#challenges-list > div *,
#achievements-list > div * {
    max-width: 100% !important;
    box-sizing: border-box !important;
}

/* Кнопки внутри карточек */
#groups-list button,
#challenges-list button {
    flex-shrink: 0 !important;
    min-width: 0 !important;
    white-space: nowrap !important;
}

/* Flex контейнеры внутри карточек */
#groups-list .flex,
#leaderboard-list .flex,
#challenges-list .flex,
#achievements-list .flex {
    min-width: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
}

/* Flex-1 элементы должны уметь сжиматься */
#groups-list .flex-1,
#leaderboard-list .flex-1,
#challenges-list .flex-1,
#achievements-list .flex-1 {
    min-width: 0 !important;
    overflow: hidden !important;
}

/* Текст внутри карточек */
#groups-list h3,
#groups-list p,
#leaderboard-list .font-medium,
#challenges-list h3,
#challenges-list p,
#achievements-list h3,
#achievements-list p {
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    max-width: 100% !important;
}

/* Select элементы (базовые стили в components/common/forms.css) */
#leaderboard-group-select,
#leaderboard-sort-select,
#achievements-group-select {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
}

/* Заголовки секций */
#social > div > div:first-child {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
}

/* Контентные области секций */
#social > div > div:last-child {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
    min-width: 0 !important;
}

/* Кнопки в секциях */
#social button {
    white-space: nowrap !important;
    flex-shrink: 0 !important;
    min-width: fit-content !important;
}

/* Мобильные устройства */
@media (max-width: 1024px) {
    #social {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
    }
    
    /* На мобильных все колонки занимают полную ширину */
    #social > div {
        width: 100% !important;
        max-width: 100% !important;
        grid-column: span 1 !important; /* Отменяем col-span-2 на мобильных */
    }
    
    /* На мобильных кнопки могут переноситься */
    #social button span {
        display: inline !important;
    }
}

/* Планшеты */
@media (min-width: 1024px) and (max-width: 1280px) {
    #social {
        gap: 1rem !important;
    }
}

/* Стили для нижней навигации */
#bottom-navigation {
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    width: 100% !important;
    left: 0 !important;
    right: 0 !important;
}

#bottom-navigation > div {
    width: 100% !important;
    max-width: 100% !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    box-sizing: border-box !important;
}

.mobile-nav-btn {
    transition: all 0.2s ease;
    position: relative;
    min-width: 0;
    overflow: visible;
    flex: 1 1 0;
}

.mobile-nav-btn span {
    white-space: nowrap;
    overflow: visible;
    display: block;
    text-align: center;
    line-height: 1.2;
}

.mobile-nav-btn:active {
    transform: scale(0.95);
    background-color: rgba(0, 0, 0, 0.05);
}

.mobile-nav-btn.active-nav {
    color: #4f46e5 !important; /* indigo-600 */
}

.mobile-nav-btn.active-nav i {
    color: #4f46e5 !important;
}

.mobile-nav-btn.active-nav span {
    color: #4f46e5 !important;
}

/* Анимация для активной кнопки */
.mobile-nav-btn.active-nav::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 3px;
    background: linear-gradient(to right, #4f46e5, #7c3aed);
    border-radius: 3px 3px 0 0;
}
